<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Boka flytt – CityTransport</title>
<style>
body { font-family: Arial, sans-serif; background:#f4f4f4; margin:0; padding:0; }
header { text-align:center; padding:40px 20px; background:#333; color:white; }
header h1 { font-size:2.5rem; margin-bottom:10px; }
header p { font-size:1.2rem; color:#ddd; }

#booking { max-width:900px; margin:40px auto; padding:30px; background:white; border-radius:15px; box-shadow:0 4px 20px rgba(0,0,0,0.1); text-align:center; }
#booking h2 { margin-bottom:20px; color:#333; }

#month-nav { display:flex; justify-content:space-between; margin-bottom:10px; }
#month-nav button { padding:8px 15px; background:#28a745; color:white; border:none; border-radius:5px; cursor:pointer; }
#month-nav button:hover { background:#218838; }

#calendar table { border-collapse: collapse; width:100%; max-width:700px; margin:10px auto; border-radius:10px; overflow:hidden; }
#calendar th, #calendar td { padding:12px; text-align:center; }
#calendar th { background:#28a745; color:white; }
#calendar td.available { background:#d1f0d1; cursor:pointer; transition:0.3s; }
#calendar td.available:hover { background:#a7e6a7; }
#calendar td.booked { background:#f0d1d1; cursor:not-allowed; }

#time-select { display:none; margin:20px auto; padding:10px; font-size:1rem; border-radius:5px; border:1px solid #ccc; }
#customer-form { display:none; max-width:450px; margin:20px auto; text-align:left; }
#customer-form input, #customer-form textarea { width:100%; padding:10px; margin-bottom:10px; border-radius:5px; border:1px solid #ccc; font-size:1rem; }
#customer-form button { background-color:#28a745; color:white; padding:12px; border:none; border-radius:5px; cursor:pointer; width:100%; font-size:1rem; }
#customer-form button:hover { background-color:#218838; }
#status { margin-top:15px; font-weight:bold; color:#333; text-align:center; font-size:1.1rem; }
</style>
</head>
<body>

<header>
<h1>Boka din flytt med CityTransport</h1>
<p>Välj ett datum, se lediga tider och boka enkelt direkt här.</p>
</header>

<section id="booking">
  <h2>Steg 1: Välj datum</h2>
  <div id="month-nav">
    <button id="prev-month">← Föregående</button>
    <div id="current-month"></div>
    <button id="next-month">Nästa →</button>
  </div>
  <div id="calendar"></div>

  <h2 id="time-header" style="display:none;">Steg 2: Välj tid</h2>
  <select id="time-select">
    <option value="">Välj tid</option>
  </select>

  <h2 id="form-header" style="display:none;">Steg 3: Fyll i dina uppgifter</h2>
  <form id="customer-form">
    <input type="text" id="name" name="name" placeholder="Ditt namn" required>
    <input type="email" id="email" name="email" placeholder="Din e-post" required>
    <input type="tel" id="phone" name="phone" placeholder="Ditt telefonnummer" required>
    <textarea id="message" name="message" placeholder="Meddelande (valfritt)"></textarea>
    <button type="submit">Skicka bokning</button>
  </form>

  <p id="status"></p>
</section>

<script src="https://cdn.emailjs.com/dist/email.min.js"></script>
<script>
emailjs.init("E7HH_m3tC91tBo8Vr"); // Din Public Key

const calendarEl = document.getElementById('calendar');
const timeSelect = document.getElementById('time-select');
const customerForm = document.getElementById('customer-form');
const status = document.getElementById('status');
const currentMonthEl = document.getElementById('current-month');
const timeHeader = document.getElementById('time-header');
const formHeader = document.getElementById('form-header');

let selectedDate = null;
let current = new Date();
const availableTimes = ["09:00","11:00","13:00","15:00"];

function renderCalendar(date) {
  const year = date.getFullYear();
  const month = date.getMonth();
  currentMonthEl.textContent = date.toLocaleString('sv-SE', { month:'long', year:'numeric' });

  const firstDay = new Date(year, month, 1);
  const lastDay = new Date(year, month + 1, 0);

  let table = `<table><tr>`;
  const weekdays = ["Sön","Mån","Tis","Ons","Tor","Fre","Lör"];
  weekdays.forEach(d => table+=`<th>${d}</th>`); 
  table += `</tr><tr>`;
  for(let i=0;i<firstDay.getDay();i++) table += `<td></td>`;
  for(let day=1; day<=lastDay.getDate(); day++){
    const dayDate = new Date(year, month, day);
    const dayStr = dayDate.toISOString().split('T')[0];
    const cls="available"; // Kan kopplas mot Sheet
    table += `<td class="${cls}" data-date="${dayStr}">${day}</td>`;
    if((day+firstDay.getDay())%7===0) table+=`</tr><tr>`;
  }
  table += `</tr></table>`;
  calendarEl.innerHTML = table;

  document.querySelectorAll('#calendar td.available').forEach(cell=>{
    cell.addEventListener("click", ()=>{
      selectedDate = cell.dataset.date;
      timeSelect.innerHTML = `<option value="">Välj tid</option>`;
      availableTimes.forEach(t=>{
        const option = document.createElement("option");
        option.value = t; option.textContent = t;
        timeSelect.appendChild(option);
      });
      timeSelect.style.display="block";
      customerForm.style.display="none";
      timeHeader.style.display="block";
      formHeader.style.display="none";
      status.textContent="";
    });
  });
}

document.getElementById('prev-month').addEventListener('click', ()=>{ current.setMonth(current.getMonth()-1); renderCalendar(current); });
document.getElementById('next-month').addEventListener('click', ()=>{ current.setMonth(current.getMonth()+1); renderCalendar(current); });

renderCalendar(current);

timeSelect.addEventListener("change", ()=>{
  if(timeSelect.value){
    customerForm.style.display="block";
    formHeader.style.display="block";
  } else {
    customerForm.style.display="none";
    formHeader.style.display="none";
  }
});

customerForm.addEventListener('submit', function(e){
  e.preventDefault();

  if(!selectedDate){
    status.style.color="red"; status.textContent="Välj datum först!";
    return;
  }
  if(!timeSelect.value){
    status.style.color="red"; status.textContent="Välj tid först!";
    return;
  }

  let timeInput = customerForm.querySelector('input[name="time"]');
  if(!timeInput){
    timeInput = document.createElement('input');
    timeInput.type='hidden';
    timeInput.name='time';
    customerForm.appendChild(timeInput);
  }
  timeInput.value = selectedDate + " " + timeSelect.value;

  emailjs.sendForm('service_luw5k4u', 'template_cpux8e5', customerForm)
    .then(()=>{
      status.style.color="green";
      status.textContent="Bokning skickad! Bekräftelse skickas till kunden.";
      customerForm.reset(); timeSelect.value=""; timeSelect.style.display="none";
      selectedDate=null; timeHeader.style.display="none"; formHeader.style.display="none";
    }, (err)=>{
      status.style.color="red"; status.textContent="Något gick fel, försök igen.";
      console.error("EmailJS Error:", err);
    });
});
</script>

</body>
</html>
